

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tests.core.test_base_sentence_generator &mdash; scenario_tool 0.0.7 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=34969b80"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=beaddf03"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            scenario_tool
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">scenario_tool</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">scenario_tool</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">模块代码</a></li>
      <li class="breadcrumb-item active">tests.core.test_base_sentence_generator</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>tests.core.test_base_sentence_generator 源代码</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">测试 BaseSentenceGenerator 基类</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span>
<span class="kn">from</span> <span class="nn">core.base_sentence_generator</span> <span class="kn">import</span> <span class="n">BaseSentenceGenerator</span>
<span class="kn">from</span> <span class="nn">core.param_translator</span> <span class="kn">import</span> <span class="n">ParamTranslator</span>
<span class="kn">from</span> <span class="nn">core.config_manager</span> <span class="kn">import</span> <span class="n">EngineConfig</span>


<span class="c1"># 创建具体的生成器类用于测试（因为 BaseSentenceGenerator 是抽象类）</span>
<span class="c1"># 注意：不要以 Test 开头，否则 pytest 会误认为这是测试类</span>
<div class="viewcode-block" id="ConcreteSentenceGenerator">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.ConcreteSentenceGenerator">[文档]</a>
<span class="k">class</span> <span class="nc">ConcreteSentenceGenerator</span><span class="p">(</span><span class="n">BaseSentenceGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;用于测试的具体生成器实现&quot;&quot;&quot;</span>

    <span class="n">param_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;translate_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Music&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;play music </span><span class="si">{value}</span><span class="s2">&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;Speaker&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;translate_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Speaker&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;Background&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;translate_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">,</span> <span class="s2">&quot;Scene&quot;</span><span class="p">],</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;scene </span><span class="si">{value}</span><span class="s2">&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;Volume&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;100&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;volume </span><span class="si">{value}</span><span class="s2">&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;test&quot;</span>

<div class="viewcode-block" id="ConcreteSentenceGenerator.process">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.ConcreteSentenceGenerator.process">[文档]</a>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;test command: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span></div>
</div>



<div class="viewcode-block" id="TestBaseSentenceGenerator">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator">[文档]</a>
<span class="k">class</span> <span class="nc">TestBaseSentenceGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;测试 BaseSentenceGenerator 基类&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestBaseSentenceGenerator.mock_translator">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.mock_translator">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">mock_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建模拟的翻译器&quot;&quot;&quot;</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">ParamTranslator</span><span class="p">)</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;translated_</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">has_mapping</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">translator</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.mock_config">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.mock_config">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">mock_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建模拟的引擎配置&quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">EngineConfig</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">engine_type</span> <span class="o">=</span> <span class="s2">&quot;test_engine&quot;</span>
        <span class="n">config</span><span class="o">.</span><span class="n">file_extension</span> <span class="o">=</span> <span class="s2">&quot;.test&quot;</span>
        <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.generator">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.generator">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建测试生成器实例&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ConcreteSentenceGenerator</span><span class="p">(</span><span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_init">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_init">[文档]</a>
    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试初始化&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">translator</span> <span class="o">==</span> <span class="n">mock_translator</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">engine_config</span> <span class="o">==</span> <span class="n">mock_config</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_category_property">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_category_property">[文档]</a>
    <span class="k">def</span> <span class="nf">test_category_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 category 属性&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_priority_default">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_priority_default">[文档]</a>
    <span class="k">def</span> <span class="nf">test_priority_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试默认优先级&quot;&quot;&quot;</span>
        <span class="c1"># 因为模块名不包含数字前缀，应该返回 999</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">999</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_can_process">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_can_process">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;data,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">({},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_can_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 can_process 方法&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">can_process</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_process_method">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_process_method">[文档]</a>
    <span class="k">def</span> <span class="nf">test_process_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 process 方法&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;test command: {&#39;test&#39;: &#39;data&#39;}&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_process_with_empty_data">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_process_with_empty_data">[文档]</a>
    <span class="k">def</span> <span class="nf">test_process_with_empty_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 process 方法（空数据）&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">process</span><span class="p">({})</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_do_translate_single_type">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_do_translate_single_type">[文档]</a>
    <span class="k">def</span> <span class="nf">test_do_translate_single_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译单一类型参数&quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Music&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;translated_bgm_main&quot;</span>
        <span class="n">mock_translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_do_translate_multiple_types">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_do_translate_multiple_types">[文档]</a>
    <span class="k">def</span> <span class="nf">test_do_translate_multiple_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译多类型参数&quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Background&quot;</span><span class="p">:</span> <span class="s2">&quot;scene1&quot;</span><span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># 应该尝试第一个类型</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;translated_scene1&quot;</span>
        <span class="n">mock_translator</span><span class="o">.</span><span class="n">has_mapping</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_do_translate_empty_value">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_do_translate_empty_value">[文档]</a>
    <span class="k">def</span> <span class="nf">test_do_translate_empty_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译空值&quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Speaker&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># 空值不应该被翻译</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Music&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Speaker&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">mock_translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_do_translate_no_config">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_do_translate_no_config">[文档]</a>
    <span class="k">def</span> <span class="nf">test_do_translate_no_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译没有配置的参数&quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;UnknownParam&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># 没有配置的参数应该保持原样</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;UnknownParam&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span>
        <span class="n">mock_translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_do_translate_preserves_original">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_do_translate_preserves_original">[文档]</a>
    <span class="k">def</span> <span class="nf">test_do_translate_preserves_original</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译不修改原始数据&quot;&quot;&quot;</span>
        <span class="n">original</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>

        <span class="c1"># 原始数据不应该被修改</span>
        <span class="k">assert</span> <span class="n">original</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">}</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">original</span>  <span class="c1"># 应该是新的字典</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_get_int">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_get_int">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;value,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># 有效整数</span>
        <span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;-456&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">456</span><span class="p">),</span>
        <span class="c1"># 浮点数（取整）</span>
        <span class="p">(</span><span class="s2">&quot;123.45&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;99.9&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
        <span class="c1"># 无效字符串（返回原值）</span>
        <span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="c1"># 数字类型</span>
        <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">45.67</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 get_int 方法&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_get_format_in_config">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_get_format_in_config">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;param_name,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="s2">&quot;play music </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;NonExistent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># 没有 format</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_format_in_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试获取格式字符串&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">get_format_in_config</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_get_value">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_get_value">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;param_name,data,use_default,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># 存在的值</span>
        <span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">),</span>
        <span class="c1"># 不存在的值</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="c1"># 使用默认值</span>
        <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">),</span>
        <span class="c1"># 不使用默认值</span>
        <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="c1"># 自动转换为字符串</span>
        <span class="p">(</span><span class="s2">&quot;Number&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Number&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Float&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Float&quot;</span><span class="p">:</span> <span class="mf">45.67</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;45.67&quot;</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">use_default</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 get_value 方法&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">use_default</span><span class="o">=</span><span class="n">use_default</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_get_sentence">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_get_sentence">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;param_name,data,use_default,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># 有值</span>
        <span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;play music bgm_main&quot;</span><span class="p">),</span>
        <span class="c1"># 无值</span>
        <span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="c1"># 使用默认值</span>
        <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;volume 100&quot;</span><span class="p">),</span>
        <span class="c1"># 没有格式字符串</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_sentence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">use_default</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 get_sentence 方法&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">get_sentence</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">use_default</span><span class="o">=</span><span class="n">use_default</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_exists_param">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_exists_param">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;param_name,data,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># 参数存在</span>
        <span class="p">(</span><span class="s2">&quot;Music&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># 即使值为空</span>
        <span class="c1"># 参数不存在</span>
        <span class="p">(</span><span class="s2">&quot;Speaker&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Music&quot;</span><span class="p">:</span> <span class="s2">&quot;bgm_main&quot;</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_exists_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试 exists_param 方法&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">exists_param</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="TestBaseSentenceGenerator.test_repr">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestBaseSentenceGenerator.test_repr">[文档]</a>
    <span class="k">def</span> <span class="nf">test_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试字符串表示&quot;&quot;&quot;</span>
        <span class="n">repr_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;ConcreteSentenceGenerator&quot;</span> <span class="ow">in</span> <span class="n">repr_str</span>
        <span class="k">assert</span> <span class="s2">&quot;category=test&quot;</span> <span class="ow">in</span> <span class="n">repr_str</span>
        <span class="k">assert</span> <span class="s2">&quot;priority=999&quot;</span> <span class="ow">in</span> <span class="n">repr_str</span></div>
</div>



<div class="viewcode-block" id="TestPriorityExtraction">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestPriorityExtraction">[文档]</a>
<span class="k">class</span> <span class="nc">TestPriorityExtraction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;测试优先级提取功能&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestPriorityExtraction.mock_translator">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestPriorityExtraction.mock_translator">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">mock_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建模拟的翻译器&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">ParamTranslator</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPriorityExtraction.mock_config">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestPriorityExtraction.mock_config">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">mock_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建模拟的引擎配置&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">EngineConfig</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPriorityExtraction.test_priority_with_prefix">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestPriorityExtraction.test_priority_with_prefix">[文档]</a>
    <span class="k">def</span> <span class="nf">test_priority_with_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试带数字前缀的优先级&quot;&quot;&quot;</span>
        <span class="c1"># 创建一个模拟的生成器，模块名包含数字前缀</span>
        <span class="k">class</span> <span class="nc">PrefixedGenerator</span><span class="p">(</span><span class="n">BaseSentenceGenerator</span><span class="p">):</span>
            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;prefixed&quot;</span>

            <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># 模拟模块名</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="n">PrefixedGenerator</span><span class="p">(</span><span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">)</span>
        <span class="c1"># 手动设置模块名来测试</span>
        <span class="n">generator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;engines.test.10_test_generator&quot;</span>

        <span class="c1"># 应该提取出 10</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="TestPriorityExtraction.test_priority_without_prefix">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestPriorityExtraction.test_priority_without_prefix">[文档]</a>
    <span class="k">def</span> <span class="nf">test_priority_without_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试不带数字前缀的优先级&quot;&quot;&quot;</span>
        <span class="k">class</span> <span class="nc">NoPrefixGenerator</span><span class="p">(</span><span class="n">BaseSentenceGenerator</span><span class="p">):</span>
            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;no_prefix&quot;</span>

            <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="n">generator</span> <span class="o">=</span> <span class="n">NoPrefixGenerator</span><span class="p">(</span><span class="n">mock_translator</span><span class="p">,</span> <span class="n">mock_config</span><span class="p">)</span>
        <span class="n">generator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;engines.test.test_generator&quot;</span>

        <span class="c1"># 应该返回默认值 999</span>
        <span class="k">assert</span> <span class="n">generator</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">999</span></div>
</div>



<div class="viewcode-block" id="TestTranslateMultipleTypes">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestTranslateMultipleTypes">[文档]</a>
<span class="k">class</span> <span class="nc">TestTranslateMultipleTypes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;测试多类型翻译的详细场景&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTranslateMultipleTypes.generator_with_multi_types">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestTranslateMultipleTypes.generator_with_multi_types">[文档]</a>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">generator_with_multi_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建支持多类型翻译的生成器&quot;&quot;&quot;</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">ParamTranslator</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">EngineConfig</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">MultiTypeGenerator</span><span class="p">(</span><span class="n">BaseSentenceGenerator</span><span class="p">):</span>
            <span class="n">param_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Asset&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;translate_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">,</span> <span class="s2">&quot;Character&quot;</span><span class="p">,</span> <span class="s2">&quot;Music&quot;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;multi&quot;</span>

            <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">MultiTypeGenerator</span><span class="p">(</span><span class="n">translator</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslateMultipleTypes.test_translate_first_match">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestTranslateMultipleTypes.test_translate_first_match">[文档]</a>
    <span class="k">def</span> <span class="nf">test_translate_first_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator_with_multi_types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译第一个匹配的类型&quot;&quot;&quot;</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">translator</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">has_mapping</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s2">&quot;translated_bg&quot;</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Asset&quot;</span><span class="p">:</span> <span class="s2">&quot;bg_001&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;translated_bg&quot;</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;Background&quot;</span><span class="p">,</span> <span class="s2">&quot;bg_001&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslateMultipleTypes.test_translate_second_match">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestTranslateMultipleTypes.test_translate_second_match">[文档]</a>
    <span class="k">def</span> <span class="nf">test_translate_second_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator_with_multi_types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试翻译第二个匹配的类型&quot;&quot;&quot;</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">translator</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">has_mapping</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s2">&quot;translated_char&quot;</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Asset&quot;</span><span class="p">:</span> <span class="s2">&quot;char_001&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;translated_char&quot;</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;Character&quot;</span><span class="p">,</span> <span class="s2">&quot;char_001&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslateMultipleTypes.test_translate_no_match">
<a class="viewcode-back" href="../../../tests.core.html#tests.core.test_base_sentence_generator.TestTranslateMultipleTypes.test_translate_no_match">[文档]</a>
    <span class="k">def</span> <span class="nf">test_translate_no_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator_with_multi_types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;测试没有匹配的类型&quot;&quot;&quot;</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">translator</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">has_mapping</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Asset&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown_001&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator_with_multi_types</span><span class="o">.</span><span class="n">do_translate</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># 没有匹配时应该保持原值</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;unknown_001&quot;</span>
        <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, Kirmy。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>